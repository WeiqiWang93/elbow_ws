<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>swarm-robotic-mining: ROS package bot_common_ros README</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">swarm-robotic-mining
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('autotoc_md6.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ROS package bot_common_ros README </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md7"></a>
made by OffWorld Inc. (www.offworld.ai)</h1>
<h2><a class="anchor" id="autotoc_md8"></a>
How To: auto calibrate cameras with respect to arm base</h2>
<h3><a class="anchor" id="autotoc_md9"></a>
Steps:</h3>
<ul>
<li>Powering chisel/saw arm \<ol type="1">
<li>Turn red knob to on position.\</li>
<li>Turn on inverter switch (about 2 inches below OBP power button).\</li>
<li>Press green button on UR 10 box (wait for sound).</li>
</ol>
</li>
<li>Connecting to chisel bot:\<ol type="1">
<li>Connect to chisel ethernet network.\</li>
<li>Ping 192.168.3.102 to verify connection.\</li>
<li>Open VNC viewer and connect to chisel (password: chiselbot).</li>
</ol>
</li>
<li>Attach checkerboard attachment to end-effector. <br  />
* In bot_common_ros/launch/camera_calibration_new.launch set use1/2/3/4 to true and others to false depending on which camera we are calibrating.\</li>
<li>run <code>roslaunch bot_common_ros camera_calibration_new.launch</code></li>
<li>Adjust the end effector using VNC so that the checkerboard is completely in the FOV of the camera.</li>
<li>run <code>rosrun tuw_checkerboard tuw_checkerboard_node image:=/camera_01/rgb/image_raw camera_info:=/camera_01/rgb/camera_info</code> adjusting for the specific camera number</li>
<li>Check the image to ensure checkerboard were successfully found.</li>
<li>run <code>rosrun dynamic_reconfigure dynparam set /tuw_checkerboard checkerboard_square_size 0.024</code> to set the square size</li>
<li>If the camera image is rotated (check by looking at the axes of TCP and checkerboard frame in rviz), then run <code>rosrun dynamic_reconfigure dynparam set /tuw_checkerboard rotate_camera_image_180 true</code> to rotate by 180 degrees.</li>
<li>Set the rosparam values between checkerboard and nominal TCP such that the axes of checkerboard in RVIZ align with the tuw image. Also verify that the chisel TCP coincides with the checkerboard.</li>
<li>Load the params files (containing the fixed extrinsics TCP to base) by running the following:\<ol type="1">
<li><code>roscd bot_common_ros/config/params</code>\</li>
<li><code>rosparam load arm_params.yaml</code>\</li>
<li><code>rosparam load transform_params.yaml</code></li>
</ol>
</li>
<li>run <code>rosrun bot_common_ros ur10_driver.py _input_param_path:=/ur10_driver/arm_2_chisel/params _dry_run:=False</code></li>
<li>In arm params edit arm/name in checkerboard calibration depending on whether the cameras are wrt saw base or chisel base checkerboard_calibration:\ arm:\ id: 1\ name: "/chisel"\ TCP: [-0.084, 0.06, 0.025, 0.0, 0.0, -1.57] # position and orientation of TCP w.r.t. Nominal-TCP\ mass: 0.0\ CG: [0.0, 0.0, 0.0] # center of gravity in m of end-effector</li>
<li>run <code>rosrun tf tf_echo "saw_base" "camera_04_link"</code> with the correct "base" and "camera_number"</li>
</ul>
<p>&lt;!&mdash; Commented out toby's lines for now &lt;run `camera_auto_calibration.sh [camera_id]`, don't forget the leading `0` #copy the translation and quaternion of output of form </p><div class="fragment"><div class="line">--&gt;</div><div class="line">* Expected Output:</div></div><!-- fragment --><p> At time 1253924111.082</p><ul>
<li>Translation: [-1.989, 0.151, 0.000]</li>
<li>Rotation: in Quaternion [0.000, 0.000, -0.046, 0.999] in RPY [0.000, -0.000, -0.092] <div class="fragment"><div class="line">* Copy and paste the values into `camera_calibration.yaml` file.</div><div class="line"> </div><div class="line">&lt;!--into the corresponding values of `camera_calibration.yaml` file.--&gt;</div><div class="line"> </div><div class="line">#### Load calibrated camera parameters</div><div class="line">TODO: finalize this, it&#39;s not quite right  </div><div class="line">Add the following code to your launch file</div></div><!-- fragment --> &lt;arg name="device_1_prefix" default="01"&gt; &lt;rosparam command="load" file="$(find bot_common_ros)/config/params/camera_calibration.yaml"&gt; &lt;node pkg="tf" type="static_transform_publisher" name="camera_broadcaster1" args="x y z qx qy qz qw base camera_0$(arg device_1_prefix) 100"&gt; <div class="fragment"><div class="line"># Testing</div><div class="line"> </div><div class="line">## test ur10_driver</div><div class="line">load rosparams from command line in the tests directory</div></div><!-- fragment --> roscd bot_common_ros/tests rosparam load test_params.yaml ``` command line run, specifying if it's in sim and if using api <br  />
<code>rosrun bot_common_ros ur10_driver.py _input_param_path:=/ur10_driver/arm_1/params _dry_run:=False _run_test:=True _run_api:=True _sim:=True</code></li>
</ul>
<h1><a class="anchor" id="autotoc_md10"></a>
Run ur10_driver server</h1>
<p>load rosparams from command line in the tests directory </p><div class="fragment"><div class="line">roscd bot_common_ros/tests</div><div class="line">rosparam load test_params.yaml</div></div><!-- fragment --><p> command line run, specifying if it's in sim and if using api <br  />
<code>rosrun bot_common_ros ur10_driver.py _input_param_path:=/ur10_driver/arm_1/params _dry_run:=False</code></p>
<h1><a class="anchor" id="autotoc_md11"></a>
Run robo-saw-action-server</h1>
<p>Remember to fill the inputs correctly; whether it's in sim, whether to run the arm-client as an api, input ros-topics. <br  />
</p><div class="fragment"><div class="line">cd $OFFWORLD_ROOT/Code/offworld-ur/Chiseling\ Baselines</div><div class="line">python robo_saw_action_server.py _sim:=True _client_topic:=/test_ur10_driver/arm _input_param_path:=/ur10_driver/arm_1/params _run_api:=False</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
